<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
	xmlns:f="http://xmlns.jcp.org/jsf/core">

<h:head>
	<meta charset="utf-8" />

	<!-- LOGIN REDIRECT -->
	<ui:fragment
		rendered="#{!authenticationController.hasOperatorAccess()}">
		<meta http-equiv="refresh" content="0; url=login.xhtml" />
	</ui:fragment>

	<f:metadata>
		<f:viewAction action="#{liveTrainOverviewController.loadPage()}" />
	</f:metadata>

	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<link href="css/bootstrap.min.css" rel="stylesheet" />
	<link href="css/extra_layout.css" rel="stylesheet" />
	<link rel="stylesheet" href="css/leaflet.css" />
	<link rel="stylesheet" href="css/extra_layout.css" />
	<link rel="stylesheet" href="css/constraint_editor.css" />
	<link rel="stylesheet" href="css/login.css" />
	<title><ui:insert name="title">Constraint Engine Editor</ui:insert></title>
</h:head>

<!-- Renders when logged in -->
<h:body rendered="#{authenticationController.hasOperatorAccess()}">

	<ui:define name="nav_content">
		<li><a href="index.xhtml">Dashboard</a></li>
		<li class="active"><a href="live_train_overview.xhtml">Live
				Tracking</a></li>
	</ui:define>

	<!-- FIXED NAVBAR -->
	<ui:include src="templates/navbar.xhtml" />

	<div class="container-fluid pad">
		<div class="row">
			<div class="col-sm-2">
				<c:forEach var="constraint"
					items="#{constraintEditorController.constraints}">
					<div id="constraint_#{constraint.id}" class="constraint">
						<h:outputText value="#{constraint.getName()}" />
						<h:inputHidden
							value="#{constraintEditorController.getPolygon(constraint.id)}"
							id="constraint_input_#{constraint.id}" class="loc_constraint" />
						<br />
						<c:forEach var="constraint_element"
							items="#{constraint.constraints}">
							<h:outputText value="#{constraint_element}"
								rendered="#{constraint_element.toString().length() != 0}" />
							<br />
						</c:forEach>
					</div>
				</c:forEach>
				<button type="button" onclick="openModal()">Nieuwe
					beperking</button>
			</div>
			<div class="col-sm-10" id="map_big" style="height: 75vh"></div>
		</div>
		<div class="row">
			<div class="col-sm-12" id="current_constraint" style="height: 75vh">
				Klik op de kaart of in de sidebar om de info van een beperking te
				tonen of te bewerken.</div>
		</div>

		<!-- Modal -->
		<div id="new_constraint_modal" class="modal fade" role="dialog">
			<div class="modal-dialog  modal-lg ">

				<h:form id="editConstraintForm">

					<!-- Modal content-->
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal">&times;</button>
							<h4 class="modal-title">Nieuwe beperking</h4>
						</div>
						<div class="modal-body">

							<div class="form-horizontal">
								<ui:repeat
									value="#{constraintEditorController.currentConstraintElements}"
									var="ce">

									<label class="sr-only" for="exampleInputAmount">Amount
										(in dollars)</label>
									<div class="input-group">

										<div class="input-group-btn">
											<button type="button" class="btn btn-default dropdown-toggle constraint-type"
												data-toggle="dropdown" aria-haspopup="true"
												aria-expanded="false">
												#{constraintEditorController.determineContraintElementType(ce)}
												<span class="caret"></span>
											</button>
											<ul class="dropdown-menu">
												<!-- Drowndown menu with all the contraint elements -->

												<!-- Value constraint elements -->
												<ui:repeat
													value="#{constraintEditorController.valueConstraintAttributes}"
													var="vca">
													<li><h:commandLink action="#{constraintEditorController.updateContraintElement(ce, vca)}">#{vca.descr}</h:commandLink></li>
												</ui:repeat>
												<li role="separator" class="divider"></li>
												<li><a href="#">model</a></li>
												<li role="separator" class="divider"></li>
												<li><a href="#">locatie</a></li>
											</ul>
										</div>
										<!-- /btn-group -->


										<div class="input-group-addon">$</div>
										<input type="text" class="form-control"
											id="exampleInputAmount" placeholder="Amount" />

										<span class="input-group-btn">
											<button class="btn btn-default" type="button">
												<span class="glyphicon glyphicon-remove-sign"
													aria-hidden="true"></span>
											</button>
										</span>
									</div>
									<br></br>
								</ui:repeat>

								<br></br>
								<div id="map_modal" style="height: 500px"></div>


								<div id="click_status">Click on the map</div>
								<label for="checkbox">Edit polygon</label> <input
									type="checkbox" ame="checkbox" value="on" id="checkbox" /> <input
									type="button" value="Clear polygon" onclick="clearPolygon()" />
								<input type="button" name="button" value="Clear last point"
									onclick="clearLast()" />
							</div>
							<!--  -->
							<h:commandLink class="btn btn-default" type="button"
								action="#{constraintEditorController.createConstraintElement()}"
								immediate="true">
								<span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span>
								Voeg element toe
								<f:ajax execute="@this" render="editConstraintForm"
									onevent="redrawModalMap" />
							</h:commandLink>
							<br></br>

						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default"
								data-dismiss="modal">Sluit</button>
							<h:commandButton type="submit" class="btn btn-primary"
								action="#{constraintEditorController.createConstraint()}"
								value="Opslaan">
							</h:commandButton>
						</div>
					</div>
				</h:form>
			</div>
		</div>

	</div>

	<script
		src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"
		type="text/javascript"></script>
	<script src="js/bootstrap.min.js" type="text/javascript"></script>
	<script src="https://unpkg.com/leaflet@1.0.0/dist/leaflet.js"></script>
	<script src="js/constraint_editor.js" type="text/javascript"></script>

</h:body>

<!-- Renders when not logged in and redirect doesnt' work -->
<h:body rendered="#{!authenticationController.hasOperatorAccess()}">
	<div class="container-fluid main_view">
		<div class="row">
			<div class="col-sm-10 col-sm-offset-1">
				<h1>You're not authorized for this page!</h1>
				<h2>
					It seems like we failed to redirect you to the <a
						href="login.xhtml">login page</a>.
				</h2>
			</div>
		</div>
	</div>
</h:body>
</html>